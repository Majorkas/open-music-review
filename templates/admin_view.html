{% set title = "Open Music Review - Admin Panel" %}
{% extends "base.html" %}
{%block main%}
<div class="admin-container">
  <h2 class="admin-title">Form Submissions</h2>

  {% if forms|length == 0 %}
    <div class="submission-card">
      <p class="submission-empty">No submissions yet.</p>
    </div>
  {% else %}
    {% for form in forms %}
      <article class="submission-card">
        <div class="submission-header">
          <h3 class="submission-name">{{ form.name }}</h3>
          <a class="submission-email" href="mailto:{{ form.email }}">{{ form.email }}</a>
        </div>

        <div class="submission-meta">
          Submitted by: <span class="submission-user">{{ form.user.username }}</span>
          <span class="submission-id">User ID: {{ form.user_id }}</span>
        </div>

        <div class="submission-message">
          {{ form.message }}
        </div>
      </article>
    {% endfor %}
  {% endif %}
</div>
<div class="admin-container">
  <h2 class="admin-title">User Reports</h2>
{% if reports|length == 0 %}
    <div class="submission-card">
      <p class="submission-empty">No Reports yet.</p>
    </div>
  {% else %}
    {% for report in reports %}
      <article class="submission-card">
        <div class="submission-header">
          <h3 class="submission-name">Report ID:{{ report.id }}</h3>


        <div class="submission-meta">
          Submitted by: <span class="submission-user">{{ report.reporter.username }}</span>
          <span class="submission-id">User ID: {{ report.reporter_id }}</span>
        </div>

        <div class="submission-message">
          {{ report.reason }}
        </div>
        <div class="review-actions">
        <a href="{{ url_for('delete_review', review_id = report.review_id) }}">Delete Review</a>
      </div>
      <div class="review-actions">
        <a href="{{ url_for('ignore_report', report_id = report.id) }}">Ignore</a>
      </div>
    </article>
    {% endfor %}
  {% endif %}
</div>
<div class="admin-container">
  <h2 class="admin-title">Registered Users</h2>
{% if users|length == 0 %}
    <div class="submission-card">
      <p class="submission-empty">No Users Registered Yet.</p>
    </div>
  {% else %}
  {% for user in users %}
    <article class="submission-card">
      <div class="submission-header">
        <h3 class="submission-name">{{ user.username }}</h3>
        <span class="submission-id">User ID: {{ user.id }}</span>
      </div>

      <div class="submission-meta">
        Privileges: <span class="submission-user">{{ 'Admin' if user.admin else 'User' }}</span>
      </div>

      <form class="user-actions" action='{{ url_for("edit_privilages", user_id=user.id) }}' method="POST">
        <label for="admin_privileges_{{ user.id }}">Change Privileges:</label>
        <select name="admin" id="admin_privileges_{{ user.id }}">
          <option value="user" {% if not user.admin %}selected{% endif %}>User</option>
          <option value="admin" {% if user.admin %}selected{% endif %}>Admin</option>
        </select>
        <button type="submit" class="login-btn">Update</button>
      </form>
    </article>
  {%endfor%}
{%endif%}

{%endblock%}
